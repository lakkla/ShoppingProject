import{_ as U,u as q,a as S,r as u,b as h,o as d,c as i,d as s,w as y,e as l,v as n,t as D,f as b,g as F,h as L}from"./index-ecdd9460.js";import{u as c}from"./index-dd35b931.js";const $={class:"login-container"},B={class:"login-box"},I={class:"form-group"},N={class:"form-group"},T={class:"form-group"},M={class:"form-group"},R={class:"form-group"},A={class:"verify-code-container"},E=["disabled"],j={class:"form-group"},z={class:"login-footer"},G={key:0},H={key:1},J={__name:"Login",setup(K){const g=q(),_=S(),p=u(!1),v=u(!1),m=u(60);let w=null;const r=u({username:"",password:""}),t=u({username:"",phone:"",verifyCode:"",newPassword:""}),f=()=>{p.value=!p.value},C=()=>{v.value=!0,m.value=60,w=setInterval(()=>{m.value--,m.value<=0&&(clearInterval(w),v.value=!1)},1e3)},x=async()=>{if(!t.value.username||!t.value.phone){alert("请先输入用户名和手机号");return}alert(`验证码已发送，请注意查收
验证码：123456`),C()},k=async()=>{if(!t.value.username||!t.value.phone||!t.value.verifyCode||!t.value.newPassword){alert("请填写完整信息");return}try{const o=new URLSearchParams;o.append("username",t.value.username),o.append("phone",t.value.phone),o.append("verifyCode",t.value.verifyCode),o.append("newPassword",t.value.newPassword);const e=await c.forgotPassword(o);e.code===200?(alert(e.message),f()):alert(e.message)}catch(o){console.error("修改密码失败:",o),o.response?o.response.data&&o.response.data.message?alert(o.response.data.message):o.response.data&&o.response.data.error?alert(`系统异常: ${o.response.data.error}`):o.response.status===404?alert("请求的接口不存在，请检查后端服务"):o.response.status===500?alert("服务器内部错误，请稍后重试"):alert(`请求失败，状态码: ${o.response.status}`):o.request?alert("网络错误，请检查后端服务是否运行"):alert(`请求错误: ${o.message}`)}},P=async()=>{try{const o=new FormData;o.append("username",r.value.username),o.append("password",r.value.password);const e=await c.login(o);e.code===200?(_.setUser(e.data),alert(e.message),e.data.role===1?g.push("/admin/index"):g.push("/product/list")):alert(e.message)}catch{alert("登录失败，请重试")}};return(o,e)=>{const V=h("router-link");return d(),i("div",$,[s("div",B,[e[16]||(e[16]=s("h2",{class:"login-title"},"用户登录",-1)),p.value?(d(),i("form",{key:1,onSubmit:y(k,["prevent"])},[s("div",T,[e[9]||(e[9]=s("label",null,"用户名",-1)),l(s("input",{"onUpdate:modelValue":e[2]||(e[2]=a=>t.value.username=a),type:"text",placeholder:"请输入用户名",required:""},null,512),[[n,t.value.username]])]),s("div",M,[e[10]||(e[10]=s("label",null,"手机号",-1)),l(s("input",{"onUpdate:modelValue":e[3]||(e[3]=a=>t.value.phone=a),type:"text",placeholder:"请输入注册时的手机号",required:""},null,512),[[n,t.value.phone]])]),s("div",R,[e[11]||(e[11]=s("label",null,"验证码",-1)),s("div",A,[l(s("input",{"onUpdate:modelValue":e[4]||(e[4]=a=>t.value.verifyCode=a),type:"text",placeholder:"请输入验证码",required:""},null,512),[[n,t.value.verifyCode]]),s("button",{type:"button",class:"btn-verify",onClick:x,disabled:v.value},D(v.value?`${m.value}s后重新获取`:"获取验证码"),9,E)])]),s("div",j,[e[12]||(e[12]=s("label",null,"新密码",-1)),l(s("input",{"onUpdate:modelValue":e[5]||(e[5]=a=>t.value.newPassword=a),type:"password",placeholder:"请输入新密码",required:""},null,512),[[n,t.value.newPassword]])]),e[13]||(e[13]=s("button",{type:"submit",class:"btn-login"},"修改密码",-1))],32)):(d(),i("form",{key:0,onSubmit:y(P,["prevent"])},[s("div",I,[e[6]||(e[6]=s("label",null,"用户名",-1)),l(s("input",{"onUpdate:modelValue":e[0]||(e[0]=a=>r.value.username=a),type:"text",placeholder:"请输入用户名",required:""},null,512),[[n,r.value.username]])]),s("div",N,[e[7]||(e[7]=s("label",null,"密码",-1)),l(s("input",{"onUpdate:modelValue":e[1]||(e[1]=a=>r.value.password=a),type:"password",placeholder:"请输入密码",required:""},null,512),[[n,r.value.password]])]),e[8]||(e[8]=s("button",{type:"submit",class:"btn-login"},"登录",-1))],32)),s("div",z,[p.value?(d(),i("span",H,[s("a",{onClick:f},"返回登录")])):(d(),i("span",G,[e[15]||(e[15]=b(" 还没有账号？ ",-1)),F(V,{to:"/register"},{default:L(()=>[...e[14]||(e[14]=[b("立即注册",-1)])]),_:1}),s("span",{class:"forgot-password-link"},[s("a",{onClick:f},"忘记密码？")])]))])])])}}},W=U(J,[["__scopeId","data-v-87199bdb"]]);export{W as default};
