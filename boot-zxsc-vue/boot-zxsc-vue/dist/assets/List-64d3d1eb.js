import{_ as N,u as V,r as y,p as $,j as D,o as a,c as u,g as L,d as e,e as k,q as h,F as A,l as B,f as m,t as r}from"./index-ecdd9460.js";import{H as I}from"./Header-0f98523e.js";import{c as _}from"./index-dd35b931.js";const j={class:"container"},H={key:0,class:"empty-cart"},M={key:1,class:"cart-content"},Q=["value"],S={class:"product-info"},T={class:"product-image"},U=["src","alt"],E={key:1,class:"no-image"},P={class:"quantity-control"},R=["onClick"],z=["value"],G=["onClick"],J=["onClick"],K={class:"cart-footer"},O={class:"total-price"},W={__name:"List",setup(X){const b=V(),i=y([]),s=y([]),d=y(!1),C=$(()=>i.value.filter(n=>s.value.includes(n.id)).reduce((n,t)=>n+t.price*t.quantity,0).toFixed(2)),p=async()=>{try{const n=await _.list();n.code===200&&(i.value=n.data)}catch(n){console.error("加载购物车失败",n)}},q=()=>{d.value?s.value=i.value.map(n=>n.id):s.value=[]},x=()=>{d.value=s.value.length===i.value.length},f=async(n,t,l,o)=>{const v=t+l;if(v<1){alert("数量不能小于1");return}if(o&&v>o){alert("库存不足");return}try{const c=new FormData;c.append("id",n),c.append("quantity",v);const g=await _.update(c);g.code===200?p():alert(g.message)}catch{alert("更新失败")}},w=async n=>{if(confirm("确定要删除该商品吗？"))try{const t=await _.delete(n);t.code===200?(alert(t.message),p()):alert(t.message)}catch{alert("删除失败")}},F=()=>{if(s.value.length===0){alert("请选择要结算的商品");return}b.push({path:"/order/create",query:{cartIds:s.value.join(",")}})};return D(()=>{p()}),(n,t)=>(a(),u("div",null,[L(I),e("div",j,[t[12]||(t[12]=e("h2",{class:"cart-title"},"我的购物车",-1)),i.value.length===0?(a(),u("div",H,[t[3]||(t[3]=e("p",null,"购物车是空的,快去选购商品吧",-1)),e("button",{onClick:t[0]||(t[0]=l=>n.$router.push("/product/list"))},"去购物")])):(a(),u("div",M,[e("table",null,[e("thead",null,[e("tr",null,[e("th",null,[k(e("input",{type:"checkbox","onUpdate:modelValue":t[1]||(t[1]=l=>d.value=l),onChange:q},null,544),[[h,d.value]])]),t[4]||(t[4]=e("th",null,"商品信息",-1)),t[5]||(t[5]=e("th",null,"单价",-1)),t[6]||(t[6]=e("th",null,"数量",-1)),t[7]||(t[7]=e("th",null,"小计",-1)),t[8]||(t[8]=e("th",null,"操作",-1))])]),e("tbody",null,[(a(!0),u(A,null,B(i.value,l=>(a(),u("tr",{key:l.id},[e("td",null,[k(e("input",{type:"checkbox","onUpdate:modelValue":t[2]||(t[2]=o=>s.value=o),value:l.id,onChange:x},null,40,Q),[[h,s.value]])]),e("td",null,[e("div",S,[e("div",T,[l.image?(a(),u("img",{key:0,src:l.image,alt:l.productName},null,8,U)):(a(),u("div",E,"无图"))]),e("span",null,r(l.productName),1)])]),e("td",null,"¥"+r(l.price),1),e("td",null,[e("div",P,[e("button",{onClick:o=>f(l.id,l.quantity,-1)},"-",8,R),e("input",{type:"number",value:l.quantity,readonly:""},null,8,z),e("button",{onClick:o=>f(l.id,l.quantity,1,l.stock)},"+",8,G)])]),e("td",null,"¥"+r((l.price*l.quantity).toFixed(2)),1),e("td",null,[e("button",{class:"btn-delete",onClick:o=>w(l.id)},"删除",8,J)])]))),128))])]),e("div",K,[e("div",null,[t[9]||(t[9]=m(" 已选择 ",-1)),e("span",null,r(s.value.length),1),t[10]||(t[10]=m(" 件商品 ",-1))]),e("div",O,[t[11]||(t[11]=m(" 总价：",-1)),e("span",null,"¥"+r(C.value),1)]),e("button",{class:"btn-checkout",onClick:F},"结算")])]))])]))}},et=N(W,[["__scopeId","data-v-fc76a4ed"]]);export{et as default};
