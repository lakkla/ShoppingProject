import{_ as q,u as x,i as C,r,j as U,o as i,c as u,g as A,d as t,t as c,w as P,e as l,v as d,z as v,F as S,l as E,m as F}from"./index-ecdd9460.js";import{A as M}from"./AdminSidebar-38f02eac.js";import{p as g,f as B,a as N}from"./index-dd35b931.js";const D={class:"admin-layout"},R={class:"main-content"},$={class:"page-header"},j={class:"page-title"},z={class:"form-card"},L={class:"form-group"},T={class:"form-group"},G=["value"],H={class:"form-group"},J={class:"form-group"},K={class:"form-group"},O={class:"image-upload"},Q={key:0,class:"image-preview"},W=["src"],X={class:"form-group"},Y={class:"form-group"},Z={class:"form-actions"},h={__name:"ProductEdit",setup(ee){const f=x(),y=C(),n=r(y.query.id||null),b=r(null),p=r(null),s=r({name:"",categoryId:"",price:0,stock:0,image:"",description:"",status:1}),m=r([]),_=async()=>{try{const o=await g.categories();o.code===200&&(m.value=o.data)}catch(o){console.error("加载分类失败",o)}},k=async()=>{if(n.value)try{const o=await g.detail(n.value);o.code===200&&(s.value={name:o.data.name,categoryId:o.data.categoryId,price:o.data.price,stock:o.data.stock,image:o.data.image||"",description:o.data.description||"",status:o.data.status})}catch(o){console.error("加载商品信息失败",o)}},I=o=>{p.value=o.target.files[0]},w=async()=>{if(!p.value){alert("请先选择图片");return}try{const o=await B.upload(p.value);o.code===200?(s.value.image=o.data,alert("图片上传成功")):alert(o.message)}catch{alert("上传失败，请重试")}},V=async()=>{try{const o={...s.value,id:n.value},e=await N.productSave(o);e.code===200?(alert(e.message),f.push("/admin/product/list")):alert(e.message)}catch{alert("保存失败")}};return U(()=>{_(),k()}),(o,e)=>(i(),u("div",D,[A(M),t("div",R,[t("div",$,[t("h2",j,c(n.value?"编辑商品":"添加商品"),1)]),t("div",z,[t("form",{onSubmit:P(V,["prevent"])},[t("div",L,[e[7]||(e[7]=t("label",null,"商品名称",-1)),l(t("input",{"onUpdate:modelValue":e[0]||(e[0]=a=>s.value.name=a),type:"text",required:""},null,512),[[d,s.value.name]])]),t("div",T,[e[9]||(e[9]=t("label",null,"分类",-1)),l(t("select",{"onUpdate:modelValue":e[1]||(e[1]=a=>s.value.categoryId=a),required:""},[e[8]||(e[8]=t("option",{value:""},"请选择分类",-1)),(i(!0),u(S,null,E(m.value,a=>(i(),u("option",{key:a.id,value:a.id},c(a.name),9,G))),128))],512),[[v,s.value.categoryId,void 0,{number:!0}]])]),t("div",H,[e[10]||(e[10]=t("label",null,"价格",-1)),l(t("input",{"onUpdate:modelValue":e[2]||(e[2]=a=>s.value.price=a),type:"number",step:"0.01",required:""},null,512),[[d,s.value.price,void 0,{number:!0}]])]),t("div",J,[e[11]||(e[11]=t("label",null,"库存",-1)),l(t("input",{"onUpdate:modelValue":e[3]||(e[3]=a=>s.value.stock=a),type:"number",required:""},null,512),[[d,s.value.stock,void 0,{number:!0}]])]),t("div",K,[e[12]||(e[12]=t("label",null,"商品图片",-1)),t("div",O,[t("input",{type:"file",onChange:I,accept:"image/*",ref_key:"fileInput",ref:b},null,544),t("button",{type:"button",onClick:w,class:"btn-upload"},"上传图片")]),s.value.image?(i(),u("div",Q,[t("img",{src:s.value.image,alt:"商品图片"},null,8,W)])):F("",!0)]),t("div",X,[e[13]||(e[13]=t("label",null,"商品描述",-1)),l(t("textarea",{"onUpdate:modelValue":e[4]||(e[4]=a=>s.value.description=a),rows:"5"},null,512),[[d,s.value.description]])]),t("div",Y,[e[15]||(e[15]=t("label",null,"状态",-1)),l(t("select",{"onUpdate:modelValue":e[5]||(e[5]=a=>s.value.status=a),required:""},[...e[14]||(e[14]=[t("option",{value:1},"上架",-1),t("option",{value:0},"下架",-1)])],512),[[v,s.value.status,void 0,{number:!0}]])]),t("div",Z,[e[16]||(e[16]=t("button",{type:"submit",class:"btn btn-primary"},"保存",-1)),t("button",{type:"button",class:"btn btn-secondary",onClick:e[6]||(e[6]=a=>o.$router.back())},"取消")])],32)])])]))}},ae=q(h,[["__scopeId","data-v-23e5f795"]]);export{ae as default};
