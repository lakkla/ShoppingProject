import{_ as f,u as h,i as y,r as p,p as g,j as x,o as a,c as l,g as b,d as e,e as k,v as q,F as C,l as I,t as n}from"./index-ecdd9460.js";import{H as w}from"./Header-0f98523e.js";import{c as F,o as N}from"./index-dd35b931.js";const D={class:"container"},A={class:"order-content"},B={class:"section"},V={class:"address-form"},H={class:"form-group"},M={class:"section"},P={class:"product-info"},R={class:"product-image"},S=["src","alt"],j={key:1,class:"no-image"},E={class:"order-footer"},L={class:"total-info"},O={class:"total-price"},T={__name:"Create",setup(U){const i=h(),c=y(),d=p([]),o=p({address:""}),_=g(()=>d.value.reduce((r,t)=>r+t.price*t.quantity,0).toFixed(2)),m=async()=>{const r=c.query.cartIds;if(!r){alert("请先选择商品"),i.push("/cart/list");return}try{const t=await F.list();if(t.code===200){const s=r.split(",").map(u=>parseInt(u));d.value=t.data.filter(u=>s.includes(u.id)),d.value.length===0&&(alert("购物车商品不存在"),i.push("/cart/list"))}}catch(t){console.error("加载购物车失败",t)}},v=async()=>{if(!o.value.address||o.value.address.trim()===""){alert("请填写收货地址");return}try{const r=new FormData;r.append("cartIds",c.query.cartIds),r.append("receiverName",""),r.append("receiverPhone",""),r.append("receiverAddress",o.value.address);const t=await N.create(r);t.code===200?(alert("订单创建成功"),i.push("/order/list")):alert(t.message)}catch{alert("订单创建失败")}};return x(()=>{m()}),(r,t)=>(a(),l("div",null,[b(w),e("div",D,[t[6]||(t[6]=e("h2",{class:"page-title"},"确认订单",-1)),e("div",A,[e("div",B,[t[2]||(t[2]=e("h3",null,"收货信息",-1)),e("form",V,[e("div",H,[t[1]||(t[1]=e("label",null,"收货地址：",-1)),k(e("textarea",{"onUpdate:modelValue":t[0]||(t[0]=s=>o.value.address=s),placeholder:"请输入收货人姓名、联系电话和详细地址",rows:"4",required:""},null,512),[[q,o.value.address]])])])]),e("div",M,[t[4]||(t[4]=e("h3",null,"商品清单",-1)),e("table",null,[t[3]||(t[3]=e("thead",null,[e("tr",null,[e("th",null,"商品信息"),e("th",null,"单价"),e("th",null,"数量"),e("th",null,"小计")])],-1)),e("tbody",null,[(a(!0),l(C,null,I(d.value,s=>(a(),l("tr",{key:s.id},[e("td",null,[e("div",P,[e("div",R,[s.image?(a(),l("img",{key:0,src:s.image,alt:s.productName},null,8,S)):(a(),l("div",j,"无图"))]),e("span",null,n(s.productName),1)])]),e("td",null,"¥"+n(s.price),1),e("td",null,n(s.quantity),1),e("td",null,"¥"+n((s.price*s.quantity).toFixed(2)),1)]))),128))])])]),e("div",E,[e("div",L,[t[5]||(t[5]=e("span",null,"商品总价：",-1)),e("span",O,"¥"+n(_.value),1)]),e("button",{class:"btn-submit",onClick:v},"提交订单")])])])]))}},K=f(T,[["__scopeId","data-v-97c08a7f"]]);export{K as default};
